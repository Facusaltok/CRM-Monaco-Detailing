<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monaco Detailing CRM — Acceso</title>
  <meta name="theme-color" content="#ffffff" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ccircle cx='64' cy='64' r='64' fill='%230a8d4b'/%3E%3Ctext x='50%25' y='58%25' text-anchor='middle' dominant-baseline='middle' font-size='62' fill='white' font-family='Arial' %3EM%3C/text%3E%3C/svg%3E">

  <!-- Tailwind minimal para estilos -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase (global) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // Cliente global (usa tus credenciales)
    window.sb = supabase.createClient(
      "https://nqokfvddbpjqrsfflntk.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xb2tmdmRkYnBqcXJzZmZsbnRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NDE5OTgsImV4cCI6MjA3MTIxNzk5OH0.A5CzSNjHJ9y012vJjDunzYMTzoxGwu6RV88OmKYOUGo"
    );
  </script>

  <style>
    body{background:#f6f8fb}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 12px 24px rgba(20,30,40,.06)}
    .btn{border:1px solid #d9e1ea;background:#fff;color:#0b1220;font-weight:700;border-radius:12px;padding:.6rem .9rem;box-shadow:0 6px 0 #e3e8ef,0 14px 24px rgba(10,20,30,.08),inset 0 1px 0 rgba(255,255,255,.7);transition:all .15s}
    .btn-primary{background:linear-gradient(90deg,#0a8d4b,#19c37d);color:#062015;border-color:#16a86a}
    .btn:hover{background:#f7fafc}
    .input{border:1px solid #d1d5db;border-radius:.7rem;padding:.65rem .8rem;width:100%}
    .input:focus{outline:none;border-color:#19c37d;box-shadow:0 0 0 3px rgba(25,195,125,.2)}
  </style>

  <script>
    // Limpia el hash de Supabase (tokens) para evitar scroll raro
    if (location.hash && /access_token|refresh_token|type=/.test(location.hash)) {
      history.replaceState(null, document.title, location.pathname + location.search);
    }
  </script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div class="card w-full max-w-md p-6">
    <h1 class="text-2xl font-extrabold text-center mb-6">Monaco Detailing CRM</h1>

    <label class="block text-sm mb-1">Email</label>
    <input id="email" type="email" class="input mb-3" placeholder="tu@correo.com" autocomplete="username email">

    <label class="block text-sm mb-1">Contraseña</label>
    <input id="pass" type="password" class="input mb-4" placeholder="••••••••" autocomplete="current-password">

    <button id="btnSignIn" class="btn btn-primary w-full mb-2">Ingresar</button>
    <button id="btnForgot" class="btn w-full">Olvidé mi contraseña</button>

    <p id="msg" class="text-center text-sm mt-3"></p>
  </div>

  <script>
    const sb = window.sb;
    const $  = (s)=>document.querySelector(s);
    const msg = $("#msg");

    (async () => {
      const { data:{ session } } = await sb.auth.getSession();
      if (session) location.href = "./dashboard.html";
    })();

    $("#btnSignIn").addEventListener("click", async () => {
      msg.textContent = "Ingresando…";
      msg.className = "text-center text-sm mt-3 text-slate-600";
      const email = $("#email").value.trim();
      const password = $("#pass").value;

      try{
        const { error } = await sb.auth.signInWithPassword({ email, password });
        if (error) throw error;
        location.href = "./dashboard.html";
      }catch(err){
        console.error(err);
        msg.textContent = err.message || "Error de red (CORS).";
        msg.className = "text-center text-sm mt-3 text-red-600";
      }
    });

    $("#btnForgot").addEventListener("click", async () => {
      const email = $("#email").value.trim();
      if (!email) {
        msg.textContent = "Ingresá tu email arriba.";
        msg.className = "text-center text-sm mt-3 text-red-600";
        return;
      }
      msg.textContent = "Enviando email de recuperación…";
      msg.className = "text-center text-sm mt-3 text-slate-600";
      try{
        const redirectTo = location.origin + "/index.html";
        const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo });
        if (error) throw error;
        msg.textContent = "Revisá tu correo para cambiar la contraseña.";
        msg.className = "text-center text-sm mt-3 text-emerald-600";
      }catch(err){
        msg.textContent = err.message || "Error de red.";
        msg.className = "text-center text-sm mt-3 text-red-600";
      }
    });
  </script>
</body>
</html>
